<% provide(:title, @user.name) %>

<div class="container">
  <div class="row">
    <!-- ユーザー情報カード -->
    <div class="col-md-4">
      <div class="card-form">
        <h3 class="text-center"><%= @user.name %></h3>
        <div class="text-center" style="margin-bottom: 20px;">
          <% if @user.admin? %>
            <span class="badge badge-danger">管理者</span>
          <% else %>
            <span class="badge badge-info">一般ユーザー</span>
          <% end %>
        </div>

        <table class="table table-condensed">
          <tbody>
            <tr>
              <th width="40%">メール</th>
              <td><%= @user.email %></td>
            </tr>
            <tr>
              <th>登録日</th>
              <td><%= @user.created_at.strftime("%Y/%m/%d") %></td>
            </tr>
          </tbody>
        </table>

        <% if current_user?(@user) || current_user.admin? %>
          <div class="text-center">
            <%= link_to "プロフィール編集", edit_user_path(@user), class: "btn btn-primary btn-sm" %>
          </div>
        <% end %>
      </div>

      <!-- タスク統計情報 -->
      <div class="card-form" style="margin-top: 20px;">
        <h4 class="text-center">タスク統計</h4>

        <div class="row text-center">
          <div class="col-xs-4">
            <div class="stat-item">
              <div class="stat-number"><%= @task_stats[:total] %></div>
              <div class="stat-label">総数</div>
            </div>
          </div>
          <div class="col-xs-4">
            <div class="stat-item">
              <div class="stat-number"><%= @task_stats[:completed] %></div>
              <div class="stat-label">完了</div>
            </div>
          </div>
          <div class="col-xs-4">
            <div class="stat-item">
              <div class="stat-number"><%= @task_stats[:completion_rate] %>%</div>
              <div class="stat-label">完了率</div>
            </div>
          </div>
        </div>

        <% if @task_stats[:total] > 0 %>
          <div style="margin-top: 15px;">
            <strong>ステータス別:</strong>
            <% @task_stats[:status_breakdown].each do |status, count| %>
              <div class="progress-item">
                <span class="task-status <%= status %>"><%= status %></span>
                <span class="pull-right"><%= count %>件</span>
              </div>
            <% end %>
          </div>

          <div style="margin-top: 10px;">
            <strong>優先度別:</strong>
            <% @task_stats[:priority_breakdown].each do |priority, count| %>
              <div class="progress-item">
                <span class="task-priority <%= priority %>"><%= priority %></span>
                <span class="pull-right"><%= count %>件</span>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- タスク一覧 -->
    <div class="col-md-8">
      <div class="card-form">
        <h4><%= @user.name %>のタスク一覧</h4>

        <% if @tasks.any? %>
          <!-- ページネーション（上部） -->
          <div class="text-center" style="margin-bottom: 20px;">
            <%= will_paginate @tasks %>
          </div>

          <% @tasks.each do |task| %>
            <div class="task-item">
              <div class="task-header">
                <h5>
                  <%= link_to task.title, task_path(task), class: "task-title-link" %>
                  <span class="task-status <%= task.status %>"><%= task.status %></span>
                  <span class="task-priority <%= task.priority %>"><%= task.priority %></span>
                </h5>
                <small class="text-muted">
                  作成: <%= task.created_at.strftime("%Y/%m/%d") %>
                  <% if task.due_date %>
                    | 期限: <%= task.due_date.strftime("%Y/%m/%d") %>
                  <% end %>
                </small>
              </div>
              <p class="task-description"><%= truncate(task.description, length: 100) %></p>
            </div>
          <% end %>

          <!-- ページネーション（下部） -->
          <div class="text-center">
            <%= will_paginate @tasks %>
          </div>
        <% else %>
          <div class="text-center text-muted" style="padding: 40px;">
            <p>まだタスクが登録されていません。</p>
            <% if current_user?(@user) %>
              <%= link_to "最初のタスクを作成", new_task_path, class: "btn btn-primary" %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="text-center" style="margin-top: 20px;">
    <%= link_to "タスク一覧に戻る", tasks_path, class: "btn btn-default" %>
  </div>
</div>
